<include file="public@header"/>
</head>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li class="active"><a href="{:url('customer/index')}">客户查询</a></li>
    </ul>
    <form class="well form-inline margin-top-20" method="get" action="{:url('customer/index')}">
        客户姓名:
        <input type="text" class="form-control" name="user_name" value="{:input('request.user_name/s','')}"
               placeholder="请输入客户姓名">
        客户地址:
        <input type="text" class="form-control" name="address" value="{:input('request.address/s','')}"
               placeholder="请输入客户地址">
        &nbsp;&nbsp;所属员工:
        <select class="form-control" name="worker_uid">
            <option value="">---- 请选择所属员工 ----</option>
            <foreach name="workerList" item="vo" key="key">
                <option value="{$key}"
                <php>echo isset($args['worker_uid'])&&$args['worker_uid']==$key?'selected':''</php>
                >{$vo}</option>
            </foreach>
        </select>
        &nbsp;&nbsp;客户状态：
        <select class="form-control" name="check_status">
            <option value="">---- 请选择客户状态 ----</option>
            <foreach name="statusList" item="vo" key="key">
                <option value="{$key}"
                <php>echo isset($args['check_status'])&&$args['check_status']==$key?'selected':''</php>
                >{$vo}</option>
            </foreach>
        </select>
        <input type="submit" class="btn btn-primary" value="搜索"/>
        <a class="btn btn-danger" href="{:url('customer/index')}">清空</a>
    </form>
    <table class="table table-hover table-bordered">
        <thead>
        <tr>
            <th width="50">ID</th>
            <th>客户姓名</th>
            <th>客户地址</th>
            <th>状态</th>
            <th>所属员工</th>
            <th>登记时间</th>
            <th width="270">{:lang('ACTIONS')}</th>
        </tr>
        </thead>
        <tbody>
        <foreach name="customerList" item="vo">
            <tr>
                <td>{$vo.id}</td>
                <td>{$vo.user_name}</td>
                <td>
                    <div class="self-nowrap" title="{$vo.address}">{$vo.address}</div>
                </td>
                <td style="color:{$statusColor[$vo.user_status]}">{$statusList[$vo.user_status]}</td>
                <td>{$workerList[$vo.worker_uid]??''}</td>
                <td>{$vo.create_time}</td>
                <td>
                    <!-- 按钮判断 -->
                    <a class="btn btn-xs btn-danger" href="{:url('customer/info',array('id'=>$vo['id']))}">查看</a>

                    <if condition="cmf_get_current_admin_id() eq $vo.worker_uid || cmf_get_current_admin_id() eq 1">
                        <a class="btn btn-xs btn-primary" href='{:url("customer/edit",array("id"=>$vo["id"]))}'>编辑</a>
                        <div class="btn btn-xs btn-success hljs-prompt my-worker" title="{$vo['worker_uid']}" data-id="{$vo['id']}">所属员工</div>
                    </if>

                    <if condition="cmf_get_current_admin_id() eq $vo.worker_uid || cmf_get_current_admin_id() eq 1">
                        <if condition="$vo['user_status'] eq 1">
                            <a class="btn btn-xs btn-danger js-ajax-dialog-btn"
                               href="{:url('customer/changeStatus',array('id'=>$vo['id'], 'type'=>2))}"
                               data-msg="您确定要停用此用户吗？">停用</a>
                        <else/>
                            <a class="btn btn-xs btn-success js-ajax-dialog-btn"
                               href="{:url('customer/changeStatus',array('id'=>$vo['id'], 'type'=>1))}"
                               data-msg="您确定要启用此用户吗？">启用</a>
                        </if>
                    </if>

                    <if condition="cmf_get_current_admin_id() eq 1">
                        <a class="btn btn-xs btn-danger js-ajax-delete"
                           href="{:url('customer/delete',array('id'=>$vo['id']))}">删除</a>
                    </if>
                </td>
            </tr>
        </foreach>
        </tbody>
    </table>
    <div class="pagination">{$page}</div>
</div>

<script src="__STATIC__/js/admin.js"></script>
<script>
    $(function () {
        $('.my-worker').on('click', function () {
            var id = $(this).attr('data-id');
            var workerUid = $(this).attr('title');
            layer.open({
                title:'请选择所属员工',
                type: 2,
                skin: 'layui-layer-rim', //加上边框
                area: ['420px', '200px'], //宽高
                content: "dialog/id/" + id + "/wid/" + workerUid,
            });
        });
    });
</script>
</body>
</html>